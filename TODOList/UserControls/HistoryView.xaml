<UserControl x:Class="Echoslate.UserControls.HistoryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:behaviors="clr-namespace:EchoSlate.Behaviors" xmlns:converters="clr-namespace:Echoslate.Converters"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:sys="clr-namespace:System;assembly=System.Runtime" xmlns:viewModels="clr-namespace:Echoslate.ViewModels"
             xmlns:wpfTool="clr-namespace:Xceed.Wpf.Toolkit;assembly=Xceed.Wpf.Toolkit"
             x:Name="HistoryViewRoot"
             d:DesignHeight="800" d:DesignWidth="1200"
             mc:Ignorable="d">
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVis" />
        <converters:WidthToBoolConverter x:Key="WideConverter" Threshold="900" />
        <converters:MathConverter x:Key="Math" />
        <converters:InvertBoolConverter x:Key="InvertBoolConverter" />
        <converters:WidthToColumnWidthConverter x:Key="ColumnHideConverter"
                                                DefaultWidth="100" Threshold="700" />
        <converters:IncrementModeToBorderBrushConverter x:Key="ModeToBrushConverter"
                                                        HighlightBrush="{StaticResource Accent}"
                                                        NormalBrush="Transparent" />
        <ContextMenu x:Key="CompletedTodoContextMenu">
            <MenuItem Command="{Binding Source={x:Reference HistoryViewRoot}, Path=DataContext.EditTodoCommand}"
                      CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                      Header="Edit Todo" />
            <MenuItem Command="{Binding Source={x:Reference HistoryViewRoot}, Path=DataContext.ReactivateTodoCommand}"
                      CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                      Header="Reactivate" />
        </ContextMenu>
    </UserControl.Resources>
    <Grid Background="{StaticResource AppDarkBackground}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3*" />
            <ColumnDefinition Width="7*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="250" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Top Left: Selected History Details  -->
        <Grid Grid.Row="0" Grid.Column="0"
              Background="{StaticResource AppDarkBackground}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="50" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Row="0" Grid.Column="0"
                        Grid.ColumnSpan="2"
                        Margin="10"
                        Orientation="Horizontal">
                <Button Width="70" Height="35"
                        Command="{Binding SelectIncrementCommand}"
                        Content="Version" />
                <Border Margin="3" Padding="3"
                        BorderBrush="{Binding SelectedIncrementMode, Converter={StaticResource ModeToBrushConverter}, ConverterParameter={x:Static viewModels:IncrementMode.Major}}"
                        BorderThickness="2" CornerRadius="3">
                    <wpfTool:IntegerUpDown Width="60" Height="30"
                                           Margin="0"
                                           Background="{StaticResource EditorBackground}"
                                           BorderBrush="Transparent"
                                           Foreground="{StaticResource Foreground}"
                                           IsEnabled="{Binding IsCurrentSelected}"
                                           Minimum="0"
                                           Value="{Binding SelectedHistoryItem.VersionMajor, UpdateSourceTrigger=PropertyChanged}" />
                </Border>
                <TextBlock VerticalAlignment="Center"
                           Foreground="{StaticResource Foreground}"
                           Text="." />
                <Border Margin="3" Padding="3"
                        BorderBrush="{Binding SelectedIncrementMode, Converter={StaticResource ModeToBrushConverter}, ConverterParameter={x:Static viewModels:IncrementMode.Minor}}"
                        BorderThickness="2" CornerRadius="3">
                    <wpfTool:IntegerUpDown Width="60" Height="30"
                                           Margin="0"
                                           Background="{StaticResource EditorBackground}"
                                           BorderBrush="Transparent"
                                           Foreground="{StaticResource Foreground}"
                                           IsEnabled="{Binding IsCurrentSelected}"
                                           Minimum="0"
                                           Value="{Binding SelectedHistoryItem.VersionMinor, UpdateSourceTrigger=PropertyChanged}" />
                </Border>
                <TextBlock VerticalAlignment="Center"
                           Foreground="{StaticResource Foreground}"
                           Text="." />
                <Border Margin="3" Padding="3"
                        BorderBrush="{Binding SelectedIncrementMode, Converter={StaticResource ModeToBrushConverter}, ConverterParameter={x:Static viewModels:IncrementMode.Build}}"
                        BorderThickness="2" CornerRadius="3">
                    <wpfTool:IntegerUpDown Width="60" Height="30"
                                           Margin="0"
                                           Background="{StaticResource EditorBackground}"
                                           BorderBrush="Transparent"
                                           Foreground="{StaticResource Foreground}"
                                           IsEnabled="{Binding IsCurrentSelected}"
                                           Minimum="0"
                                           Value="{Binding SelectedHistoryItem.VersionBuild, UpdateSourceTrigger=PropertyChanged}" />
                </Border>
                <TextBlock VerticalAlignment="Center"
                           Foreground="{StaticResource Foreground}"
                           Text="." />
                <Border Margin="3" Padding="3"
                        BorderBrush="{Binding SelectedIncrementMode, Converter={StaticResource ModeToBrushConverter}, ConverterParameter={x:Static viewModels:IncrementMode.Revision}}"
                        BorderThickness="2" CornerRadius="3">
                    <wpfTool:IntegerUpDown Width="60" Height="30"
                                           Margin="0"
                                           Background="{StaticResource EditorBackground}"
                                           BorderBrush="Transparent"
                                           Foreground="{StaticResource Foreground}"
                                           IsEnabled="{Binding IsCurrentSelected}"
                                           Minimum="0"
                                           Value="{Binding SelectedHistoryItem.VersionRevision, UpdateSourceTrigger=PropertyChanged}" />
                </Border>
            </StackPanel>
            <Button Grid.Row="1" Grid.Column="0"
                    Margin="7,0,0,0"
                    Command="{Binding CommitCommand}"
                    Content="Commit"
                    IsEnabled="{Binding CanCommit}">
                <Button.LayoutTransform>
                    <RotateTransform Angle="-90" />
                </Button.LayoutTransform>
                <Button.Style>
                    <Style BasedOn="{StaticResource BaseButtonStyle}" TargetType="Button">
                        <Setter Property="FontWeight" Value="Bold" />
                        <Setter Property="Foreground" Value="{StaticResource Foreground}" />
                        <!--  Default (normal) state  -->
                        <Setter Property="Background" Value="{StaticResource Accent}" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="4">
                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                    </Border>
                                    <ControlTemplate.Triggers>
                                        <!--  Hover state  -->
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="{StaticResource LightAccent}" />
                                        </Trigger>
                                        <!--  Pressed state  -->
                                        <Trigger Property="IsPressed" Value="True">
                                            <Setter Property="Background" Value="{StaticResource DarkAccent}" />
                                        </Trigger>
                                        <!--  Disabled state  -->
                                        <Trigger Property="IsEnabled" Value="False">
                                            <Setter Property="Background" Value="{StaticResource Accent}" />
                                            <Setter Property="Opacity" Value="0.5" />
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Button.Style>
            </Button>
            <Grid Grid.Row="1" Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="45" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <Border Grid.Row="0"
                        Margin="8,4"
                        Background="#1E1E1E" CornerRadius="7">
                    <Grid>
                        <Border BorderBrush="#999999" BorderThickness="7,7,0,0"
                                CornerRadius="7" />
                        <Border Margin="-1"
                                BorderBrush="#494949" BorderThickness="0,0,7,7"
                                CornerRadius="7" IsHitTestVisible="False" />
                        <TextBox Grid.Row="0"
                                 Margin="1"
                                 behaviors:ScrollBehavior.AlwaysScroll="True"
                                 Background="{StaticResource EditorBackground}"
                                 BorderBrush="{StaticResource Accent}"
                                 FontSize="14" FontWeight="SemiBold"
                                 Foreground="{StaticResource Foreground}"
                                 IsReadOnly="{Binding IsCurrentSelected, Converter={StaticResource InvertBoolConverter}}"
                                 MouseDoubleClick="TitleTextBox_MouseDoubleClick"
                                 Text="{Binding Title, UpdateSourceTrigger=PropertyChanged}"
                                 TextWrapping="Wrap" VerticalScrollBarVisibility="Auto">
                        </TextBox>
                    </Grid>
                </Border>
                <Border Grid.Row="1"
                        Margin="8,4"
                        Background="#1E1E1E" CornerRadius="7">
                    <Grid>
                        <Border BorderBrush="#999999" BorderThickness="7,7,0,0"
                                CornerRadius="7" />
                        <Border Margin="-1"
                                BorderBrush="#494949" BorderThickness="0,0,7,7"
                                CornerRadius="7" IsHitTestVisible="False" />
                        <TextBox Grid.Row="1"
                                 Margin="1"
                                 AcceptsReturn="True"
                                 Background="{StaticResource EditorBackground}"
                                 BorderBrush="{StaticResource Accent}"
                                 Foreground="{StaticResource Foreground}"
                                 IsReadOnly="{Binding IsCurrentSelected, Converter={StaticResource InvertBoolConverter}}"
                                 Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}"
                                 TextWrapping="Wrap" />
                    </Grid>
                </Border>
            </Grid>
        </Grid>

        <!--  Top Right: Selected History Details  -->
        <Grid Grid.Row="0" Grid.Column="1"
              Background="{StaticResource AppDarkBackground}">
            <Grid.RowDefinitions>
                <RowDefinition Height="49" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="50" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Row="0" Grid.Column="0"
                        Grid.ColumnSpan="2"
                        VerticalAlignment="Bottom"
                        Orientation="Horizontal"
                        Visibility="{Binding SelectedHistoryItem.IsCommitted, Converter={StaticResource BoolToVis}}">
                <Label Content="Commit Date:" />
                <TextBlock Margin="0,5,0,15"
                           Foreground="{StaticResource Foreground}"
                           Text="{Binding SelectedHistoryItem.CommitDate, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" />
            </StackPanel>
            <Button Grid.Row="1" Grid.Column="0"
                    Padding="10,5"
                    Command="{Binding CopyCommitMessageCommand}"
                    Content="Copy">
                <Button.LayoutTransform>
                    <RotateTransform Angle="-90" />
                </Button.LayoutTransform>
            </Button>
            <TextBox Grid.Row="1" Grid.Column="1"
                     Height="200"
                     behaviors:ScrollBehavior.AlwaysScroll="True" IsReadOnly="True"
                     Text="{Binding CommitMessage, Mode=OneWay}"
                     TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" />
        </Grid>

        <!--  Bottom Left: History List  -->
        <Grid Grid.Row="1" Grid.Column="0"
              Background="{StaticResource AppDarkBackground}">

            <Border Grid.Row="2" Grid.Column="0"
                    Margin="8,4"
                    Background="#1E1E1E" CornerRadius="7">
                <Grid>
                    <Border BorderBrush="#999999" BorderThickness="7,7,0,0"
                            CornerRadius="7" />
                    <Border Margin="-1"
                            BorderBrush="#494949" BorderThickness="0,0,7,7"
                            CornerRadius="7" IsHitTestVisible="False" />
                    <Border Margin="0"
                            Background="{StaticResource ControlBackground}"
                            BorderBrush="{StaticResource Border}"
                            BorderThickness="1" ClipToBounds="True"
                            CornerRadius="7">

                        <ListView Margin="3"
                                  Background="Transparent" BorderThickness="0"
                                  Foreground="{StaticResource SubtleForeground}"
                                  ItemContainerStyle="{StaticResource ListViewItemSelectionStyle}"
                                  ItemsSource="{Binding CommittedHistoryItems}"
                                  SelectedItem="{Binding SelectedHistoryItem}">
                            <ListView.View>
                                <GridView>
                                    <GridView.ColumnHeaderContainerStyle>
                                        <Style TargetType="GridViewColumnHeader">
                                            <Setter Property="Background" Value="{StaticResource ButtonBackground}" />
                                            <Setter Property="BorderBrush" Value="{StaticResource AppDarkBackground}" />
                                            <Setter Property="Foreground" Value="{StaticResource SubtleForeground}" />
                                            <Setter Property="BorderThickness" Value="0,0,1,1" />
                                            <Setter Property="FontWeight" Value="SemiBold" />
                                            <Setter Property="Padding" Value="8,4" />
                                            <Setter Property="HorizontalContentAlignment" Value="Left" />
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="GridViewColumnHeader">
                                                        <Border Background="{TemplateBinding Background}"
                                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                                BorderThickness="{TemplateBinding BorderThickness}">
                                                            <ContentPresenter Margin="{TemplateBinding Padding}"
                                                                              HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </GridView.ColumnHeaderContainerStyle>
                                    <GridViewColumn Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ListView}, Converter={StaticResource ColumnHideConverter}, ConverterParameter=600|120}"
                                                    DisplayMemberBinding="{Binding VersionString}"
                                                    Header="Version" />
                                    <GridViewColumn Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=ListView}, Converter={StaticResource ColumnHideConverter}, ConverterParameter=500|150}"
                                                    DisplayMemberBinding="{Binding CommitDate, StringFormat=yyyy-MM-dd HH:mm}"
                                                    Header="Date">
                                        <GridViewColumn.HeaderTemplate>
                                            <DataTemplate>
                                                <TextBlock HorizontalAlignment="Center"
                                                           FontWeight="SemiBold" Text="Date" />
                                            </DataTemplate>
                                        </GridViewColumn.HeaderTemplate>
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock HorizontalAlignment="Center" Text="{Binding CommitDate, StringFormat=yyyy-MM-dd HH:mm}" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <GridViewColumn Width="700"
                                                    DisplayMemberBinding="{Binding Title}"
                                                    Header="Title" />
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Border>
                </Grid>
            </Border>
        </Grid>

        <!--  Bottom Right: Selected History Completed Todos  -->
        <Grid Grid.Row="1" Grid.Column="1"
              Margin="7"
              Background="{StaticResource AppDarkBackground}">

            <Grid Margin="20">
                <!--  Horizontal Layout  -->
                <Grid Visibility="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}, Converter={StaticResource WideConverter}, ConverterParameter={x:Static sys:Boolean.TrueString}}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}, Converter={StaticResource Math}, ConverterParameter=/3 -10}" />
                        <ColumnDefinition Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}, Converter={StaticResource Math}, ConverterParameter=/3 -10}" />
                        <ColumnDefinition Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}, Converter={StaticResource Math}, ConverterParameter=/3 -10}" />
                    </Grid.ColumnDefinitions>
                    <StackPanel Grid.Column="0" Margin="10,0,0,0">
                        <TextBlock Margin="0,0,0,8"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource Foreground}"
                                   Text="{Binding BugsCount, StringFormat='Bugs Fixed ({0})'}" />
                        <Border Margin="7"
                                Background="{StaticResource ControlBackground}"
                                CornerRadius="7">
                            <ListView HorizontalContentAlignment="Stretch"
                                      Background="Transparent" BorderBrush="Transparent"
                                      ItemsSource="{Binding BugsCompleted}"
                                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Border Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}, Converter={StaticResource Math}, ConverterParameter=-30}"
                                                Margin="4,4,4,4" Padding="8,6"
                                                Background="{StaticResource RaisedBackground}"
                                                BorderBrush="{StaticResource Border}"
                                                BorderThickness="1"
                                                ContextMenu="{StaticResource CompletedTodoContextMenu}"
                                                CornerRadius="4">
                                            <TextBlock Margin="8,6"
                                                       FontSize="14"
                                                       Foreground="{StaticResource Foreground}"
                                                       Text="{Binding Todo}"
                                                       TextWrapping="Wrap" />
                                        </Border>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Border>
                    </StackPanel>
                    <StackPanel Grid.Column="1" Margin="10,0,0,0">
                        <TextBlock Margin="0,0,0,8"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource Foreground}"
                                   Text="{Binding FeaturesCount, StringFormat='Features Added ({0})'}" />
                        <Border Margin="7"
                                Background="{StaticResource ControlBackground}"
                                CornerRadius="7">
                            <ListView HorizontalContentAlignment="Stretch"
                                      Background="Transparent" BorderBrush="Transparent"
                                      ItemsSource="{Binding FeaturesCompleted}"
                                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Border Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}, Converter={StaticResource Math}, ConverterParameter=-30}"
                                                Margin="4,4,4,4" Padding="8,6"
                                                Background="{StaticResource RaisedBackground}"
                                                BorderBrush="{StaticResource Border}"
                                                BorderThickness="1"
                                                ContextMenu="{StaticResource CompletedTodoContextMenu}"
                                                CornerRadius="4">
                                            <TextBlock Margin="8,6"
                                                       FontSize="14"
                                                       Foreground="{StaticResource Foreground}"
                                                       Text="{Binding Todo}"
                                                       TextWrapping="Wrap" />
                                        </Border>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Border>
                    </StackPanel>
                    <StackPanel Grid.Column="2">
                        <TextBlock Margin="4"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource Foreground}"
                                   Text="{Binding OtherCount, StringFormat='Other Changes ({0})'}" />
                        <Border Margin="7"
                                Background="{StaticResource ControlBackground}"
                                CornerRadius="7">
                            <ListView HorizontalContentAlignment="Stretch"
                                      Background="Transparent" BorderBrush="Transparent"
                                      ItemsSource="{Binding OtherCompleted}"
                                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Border Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}, Converter={StaticResource Math}, ConverterParameter=-30}"
                                                Margin="4" Padding="8,6"
                                                Background="{StaticResource RaisedBackground}"
                                                BorderBrush="{StaticResource Border}"
                                                BorderThickness="1"
                                                ContextMenu="{StaticResource CompletedTodoContextMenu}"
                                                CornerRadius="4">
                                            <TextBlock FontSize="14"
                                                       Foreground="{StaticResource Foreground}"
                                                       Text="{Binding Todo}"
                                                       TextWrapping="Wrap" />
                                        </Border>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Border>
                    </StackPanel>
                </Grid>

                <!--  Vertical Layout  -->
                <StackPanel Visibility="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}, Converter={StaticResource WideConverter}, ConverterParameter={x:Static sys:Boolean.FalseString}}">
                    <StackPanel Margin="10,0,0,0">

                        <TextBlock Margin="0,0,0,8"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource Foreground}"
                                   Text="{Binding BugsCount, StringFormat='Bugs Fixed ({0})'}" />
                        <Border Margin="7"
                                Background="{StaticResource ControlBackground}"
                                CornerRadius="7">
                            <ListView Margin="0,0,0,10" HorizontalContentAlignment="Stretch"
                                      Background="Transparent" BorderBrush="Transparent"
                                      ItemsSource="{Binding BugsCompleted}"
                                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Border Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}, Converter={StaticResource Math}, ConverterParameter=-30}"
                                                Margin="4,4,8,4" Padding="8,6"
                                                Background="{StaticResource RaisedBackground}"
                                                BorderBrush="{StaticResource Border}"
                                                BorderThickness="1"
                                                ContextMenu="{StaticResource CompletedTodoContextMenu}"
                                                CornerRadius="4">
                                            <TextBlock Margin="8,6"
                                                       FontSize="14"
                                                       Foreground="{StaticResource Foreground}"
                                                       Text="{Binding Todo}"
                                                       TextWrapping="Wrap" />
                                        </Border>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Border>
                    </StackPanel>
                    <StackPanel Margin="10,0,0,0">
                        <TextBlock Margin="0,0,0,8"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource Foreground}"
                                   Text="{Binding FeaturesCount, StringFormat='Features Added ({0})'}" />
                        <Border Margin="7"
                                Background="{StaticResource ControlBackground}"
                                CornerRadius="7">
                            <ListView Margin="0,0,0,10" HorizontalContentAlignment="Stretch"
                                      Background="Transparent" BorderBrush="Transparent"
                                      ItemsSource="{Binding FeaturesCompleted}"
                                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Border Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}, Converter={StaticResource Math}, ConverterParameter=-30}"
                                                Margin="4,4,8,4" Padding="8,6"
                                                Background="{StaticResource RaisedBackground}"
                                                BorderBrush="{StaticResource Border}"
                                                BorderThickness="1"
                                                ContextMenu="{StaticResource CompletedTodoContextMenu}"
                                                CornerRadius="4">
                                            <TextBlock Margin="8,6"
                                                       FontSize="14"
                                                       Foreground="{StaticResource Foreground}"
                                                       Text="{Binding Todo}"
                                                       TextWrapping="Wrap" />
                                        </Border>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Border>
                    </StackPanel>
                    <StackPanel Margin="10,0,0,0">
                        <TextBlock Margin="0,0,0,8"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource Foreground}"
                                   Text="{Binding OtherCount, StringFormat='Other Changes ({0})'}" />
                        <Border Margin="7"
                                Background="{StaticResource ControlBackground}"
                                CornerRadius="7">
                            <ListView Margin="0,0,0,10" HorizontalContentAlignment="Stretch"
                                      Background="Transparent" BorderBrush="Transparent"
                                      ItemsSource="{Binding OtherCompleted}"
                                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Border Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Grid}, Converter={StaticResource Math}, ConverterParameter=-30}"
                                                Margin="4,4,8,4" Padding="8,6"
                                                Background="{StaticResource RaisedBackground}"
                                                BorderBrush="{StaticResource Border}"
                                                BorderThickness="1"
                                                ContextMenu="{StaticResource CompletedTodoContextMenu}"
                                                CornerRadius="4">
                                            <TextBlock Margin="8,6"
                                                       FontSize="14"
                                                       Foreground="{StaticResource Foreground}"
                                                       Text="{Binding Todo}"
                                                       TextWrapping="Wrap" />
                                        </Border>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Border>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</UserControl>